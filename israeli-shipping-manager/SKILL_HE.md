# מנהל משלוחים ישראלי

## הוראות

### שלב 1: בחירת שלדן בהתאם למשלוח
עזרו למשתמש לבחור את השלדן המתאים למשלוח. שאלו על גודל החבילה, משקל, דחיפות, יעד ותקציב. השתמשו בטבלת ההשוואה:

| שלדן | מתאים ל... | מהירות | טווח מחירים | נקודות איסוף | API זמין |
|-------|-----------|--------|-------------|--------------|----------|
| דואר ישראל | חבילות רגילות, כיסוי ארצי | 3-5 ימי עסקים | נמוך-בינוני | סניפי דואר + לוקרים | כן (EMS) |
| צ'יטה / זריזי | משלוח יום-יומיים באזור עירוני | באותו יום - יום למחרת | בינוני-גבוה | מוגבל | כן |
| HFD (אייץ'.אף.די.) | הפצה למסחר אלקטרוני | 2-4 ימי עסקים | בינוני | נקודות איסוף | כן |
| בלדר | שליחויות מהירות, מסמכים | באותו יום - יום למחרת | גבוה | דלת לדלת | מוגבל |
| מהיר לי | משלוחי מסחר אלקטרוני בזול | 3-5 ימי עסקים | נמוך | נקודות איסוף | כן |
| BOX (בוקס) | איסוף עצמי מלוקר | 2-4 ימי עסקים | נמוך-בינוני | לוקרים של BOX ברחבי הארץ | כן |

קריטריונים לבחירה:
- **גודל ומשקל:** חבילות כבדות או חריגות בגודל מגבילות את אפשרויות השלדנים
- **מהירות משלוח:** משלוח באותו יום דורש צ'יטה או בלדר; משלוח רגיל מתאים לכל השלדנים
- **אזור יעד:** המרכז (גוש דן) בכיסוי מלא; פריפריה (אילת, גליל) עם כיסוי מוגבל
- **תקציב:** מהיר לי ודואר ישראל הכי זולים; בלדר וצ'יטה פרימיום
- **איסוף מול דלת לדלת:** BOX/HFD לאיסוף עצמי; בלדר למשלוח עד הדלת

### שלב 2: עיצוב כתובת ישראלית
עצבו כתובות בהתאם לדרישות השלדן. הריצו `python scripts/format_address.py --validate` לבדיקת פורמט לפני שליחה. עיינו ב-references/address-format.md למפרט המלא.

שדות נדרשים:
- **שם רחוב** — בעברית
- **מספר בית**
- **דירה** — אם רלוונטי
- **כניסה** — אם רלוונטי (נפוץ בבניינים ישנים)
- **קומה** — אם רלוונטי
- **עיר** — בעברית
- **מיקוד** — 7 ספרות

טיפול מיוחד:
- **כתובות צבאיות:** השתמשו בפורמט כתובת צה"ל (מספר צבאי)
- **קיבוצים/מושבים:** שם הישוב + מספר בית (ללא רחוב)
- **אזורי תעשייה:** שם האזור + שם בניין/חברה
- **יישובים ערביים:** ודאו שהתעתיק תואם למאגר של השלדן

### שלב 3: הפקת תווית משלוח
לכל שלדן, הפיקו תוויות משלוח עם השדות הנדרשים:
- פרטי שולח (שם, כתובת, טלפון)
- פרטי נמען (שם, כתובת, טלפון)
- מידות ומשקל החבילה
- סוג שירות (רגיל, מהיר, רשום)
- ברקוד מעקב
- שדות ספציפיים לשלדן (ראו references/carrier-apis.md)

שיטות האינטגרציה משתנות לפי שלדן — חלקם מציעים REST API, אחרים דורשים אוטומציית דפדפן. ראו references/carrier-apis.md לפרטי אינטגרציה לכל שלדן.

### שלב 4: הגדרת מעקב חוצה-שלדנים
הטמיעו מעקב אחיד מול כל השלדנים:
- נרמלו קודי סטטוס לסט אחיד: `pending`, `picked_up`, `in_transit`, `out_for_delivery`, `delivered`, `failed_delivery`, `returned`
- בצעו פולינג לנקודות קצה של מעקב במרווחים מוגדרים (ברירת מחדל: כל שעתיים)
- שמרו נתוני מעקב בזיכרון פרסיסטנטי לניתוח היסטורי. אם זיכרון פרסיסטנטי לא זמין, ייצאו ל-`tracking-data.json`
- זהו חריגות: חבילה תקועה באותו סטטוס מעל 48 שעות, כשלי מסירה, תיקוני כתובת

### שלב 5: הגדרת התראות ללקוח
הגדירו התראות אוטומטיות ללקוחות בעת שינוי סטטוס:
- **נשלח:** WhatsApp/SMS עם מספר מעקב וצפי הגעה — "החבילה שלך נשלחה! מספר מעקב: [X]. צפי הגעה: [DATE]."
- **בדרך למסירה:** "החבילה שלך בדרך אליך! צפי הגעה היום עד [TIME]."
- **נמסר:** "החבילה נמסרה בהצלחה! תודה על הקנייה."
- **כשל מסירה:** "לא הצלחנו למסור את החבילה. נסיון נוסף מתוכנן ל-[DATE]. לתיאום: [PHONE]."
- **מוכן לאיסוף:** "החבילה שלך מחכה לך בנקודת [BOX/Post/HFD] ב-[LOCATION]. קוד איסוף: [CODE]."

כבדו שעות שקט: ללא התראות בין 22:00-08:00 שעון ישראל.

### שלב 6: טיפול בהחזרות ו-RMA
נהלו משלוחי החזרה:
- הפיקו תווית החזרה עם הפניה למספר מעקב מקורי
- עקבו אחר משלוח ההחזרה חזרה למוכר
- תמכו בסיבות החזרה שונות: פגום, פריט שגוי, שינוי דעת (14 יום הגנת צרכן בהתאם לחוק הגנת הצרכן הישראלי)
- חשבו עלות משלוח החזרה לפי שלדן
- עדכנו סטטוס הזמנה כשההחזרה מתקבלת

## דוגמאות

### דוגמה 1: מוכר מסחר אלקטרוני שולח 50 חבילות במשלוח מעורב
המשתמש אומר: "אני צריך לשלוח 50 הזמנות היום, בגדלים שונים. חלק צריכים להגיע מחר לתל אביב, השאר משלוח רגיל לכל הארץ."
פעולות:
1. ניתוח הזמנות לפי גודל, יעד ודחיפות
2. ניתוב הזמנות ליום למחרת לתל אביב לצ'יטה (12 חבילות)
3. ניתוב חבילות רגילות לדואר ישראל/מהיר לי (38 חבילות) לפי עלות
4. עיצוב כל הכתובות ואימות מיקודים
5. הפקת תוויות משלוח לפי שלדן
6. הגדרת מעקב והתראות ללקוח עבור כל 50 ההזמנות
תוצאה: 50 תוויות משלוח הופקו מ-3 שלדנים. לוח מעקב הוגדר עם התראות WhatsApp לכל לקוח. עלות משלוח כוללת משוערת: 1,850 ש"ח.

### דוגמה 2: הגדרת אינטגרציה עם נקודות איסוף BOX
המשתמש אומר: "אני רוצה להציע איסוף מלוקר BOX כאופציה בחנות המקוונת שלי"
פעולות:
1. הרשמה לגישת API של BOX (או הדרכה דרך הרשמה בדפדפן)
2. קבלת רשימת מיקומי BOX קרובים לאזור המוכר
3. הגדרת הפקת תוויות משלוח עם BOX כסוג יעד
4. הגדרת התראת מוכן-לאיסוף עם קוד לוקר
5. הגדרת מעקב אוטומטי מהפקדה ב-BOX ועד איסוף הלקוח
תוצאה: אינטגרציית BOX פעילה. לקוחות יכולים לבחור לוקר BOX בקופה, ולקבל קוד איסוף ב-WhatsApp כשהחבילה מגיעה. עלות ממוצעת למשלוח: 22 ש"ח.

### דוגמה 3: השוואת מחירים לחבילה כבדה לאילת
המשתמש אומר: "אני צריך לשלוח חבילה של 15 ק"ג לאילת, מה האפשרויות שלי?"
פעולות:
1. בדיקת זמינות שלדנים לאילת (אזור פריפריה)
2. קבלת הצעות מחיר: דואר ישראל (רשום), HFD, מהיר לי
3. הערה: צ'יטה/בלדר עשויים לא לשרת את אילת או לגבות תוספת
4. השוואת זמני אספקה ועלויות
5. המלצה על האפשרות הטובה ביותר לפי יחס מחיר/מהירות
תוצאה: טבלת השוואה — דואר ישראל ב-45 ש"ח (5 ימים), HFD ב-55 ש"ח (3 ימים), מהיר לי ב-38 ש"ח (5 ימים). המלצה: מהיר לי לתקציב, HFD למהירות.

## משאבים מצורפים

### חומרי עזר
- `references/carrier-apis.md` — נקודות קצה API, שיטות אימות, ומדריכי אינטגרציה לכל שלדן ישראלי (דואר ישראל, צ'יטה, HFD, בלדר, מהיר לי, BOX). כולל נקודות קצה לחישוב תעריפים ומעקב. היעזרו בקובץ זה בעת אינטגרציה עם שלדן ספציפי בשלבים 3-4.
- `references/address-format.md` — מפרט עיצוב כתובות ישראליות: רחוב, בית, דירה, כניסה, קומה, עיר, מיקוד. כולל פורמטים מיוחדים לקיבוצים, כתובות צבאיות ואזורי תעשייה. היעזרו בקובץ זה בעת עיצוב כתובות בשלב 2.

### סקריפטים
- `scripts/format_address.py` — מאמת ומעצב כתובות משלוח ישראליות בהתאם לדרישות השלדנים. בודק תקינות מיקוד, מנרמל טקסט עברי, ומטפל בסוגי כתובות מיוחדים (קיבוץ, צבאי, אזור תעשייה). הרצה: `python scripts/format_address.py --help`

## פתרון בעיות

### שגיאה: "Invalid mikud (ZIP code)"
סיבה: מיקוד ישראלי חייב להיות בדיוק 7 ספרות ולתאום לשילוב עיר/רחוב.
פתרון: ודאו את המיקוד באתר דואר ישראל (israelpost.co.il). בעיה נפוצה: מיקודים ישנים בני 5 ספרות — כל המיקודים בישראל הם כיום בני 7 ספרות.

### שגיאה: "Carrier API authentication failed"
סיבה: אישורי API פגו תוקף או החשבון לא הופעל לגישת API.
פתרון: בדקו תוקף מפתח API בפורטל המפתחים של השלדן. חלק מהשלדנים (צ'יטה, HFD) דורשים חוזה חתום לפני גישת API. ראו references/carrier-apis.md להגדרה לפי שלדן.

### שגיאה: "Address not recognized by carrier"
סיבה: פורמט הכתובת לא תואם למאגר של השלדן, או בעיית קידוד טקסט עברי.
פתרון: ודאו שהכתובת בקידוד UTF-8 עברית. הריצו `scripts/format_address.py --validate` לבדיקת פורמט. ליישובים ערביים, ודאו שהשלדן מקבל את האיות הספציפי. נסו תעתיקים חלופיים.

### שגיאה: "Delivery failed — recipient not found"
סיבה: נפוץ בבנייני מגורים ללא אינטרקום או עם פרטי כניסה/קומה חסרים.
פתרון: הוסיפו כניסה וקומה לכתובת. הגדירו התראת מסירה שכוללת טלפון נמען ליצירת קשר עם השליח. שקלו מעבר לנקודת איסוף (BOX/HFD) לכתובות עם כשלי מסירה חוזרים.
